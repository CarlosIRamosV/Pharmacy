---
import Layout from "../../../../layouts/Layout.astro";
import {req} from "astro/dist/core/messages";

const id = Astro.params.id;
---

<Layout title="Eliminar producto">
    <h1>Eliminar Producto</h1>
    <p>¿Estás seguro de que deseas eliminar el siguiente producto?</p>
    <p>Nombre: </p>
    <p>Descripción: </p>
    <p>Precio: </p>

    <div id="inUse" style="display: none;">
        <p>Este producto no se puede eliminar porque actualmente está en uso en una o más sucursales.</p>

        <table>
            <thead>
                <tr>
                    <th>Sucursal</th>
                    <th>Cantidad</th>
            <th>Ir a la sucursal</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Nombre de la sucursal</td>
                    <td>Cantidad</td>
                    <td><a href="#">Ir a la sucursal</a></td>
                </tr>
            </tbody>
        </table>

    </div>

    <button id="delete">Eliminar</button>
    <button onclick="location.href='../'">Cancelar</button>
</Layout>

<script define:vars={{id}}>
    fetch(`http://localhost/api/products/${id}`, {
        headers: {
            'Content-Type': 'application/json'
        }
    })
        .then(response => response.json())
        .then(data => {
            document.querySelector('p:nth-of-type(2)').textContent += data.name;
            document.querySelector('p:nth-of-type(3)').textContent += data.description;
            document.querySelector('p:nth-of-type(4)').textContent += data.price;
        })

    document.getElementById('delete').addEventListener('click', () => {
        // Alerta de confirmación
        if (window.confirm('¿Estás seguro de que deseas eliminar la sucursal?')) {
            fetch(`http://localhost/api/products/${id}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => {
                    if (response.ok) {
                        alert('Producto eliminado correctamente');
                        location.href = '../';
                    } else {
                        alert('Error al eliminar el producto');
                    }
                })
        }
    })
</script>
