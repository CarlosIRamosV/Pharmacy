---
import Layout from "../../../../layouts/Layout.astro";
import { req } from "astro/dist/core/messages";

const id = Astro.params.id;
---

<Layout title="Eliminar sucursal">
  <h1>Eliminar sucursal</h1>
  <p>¿Estás seguro de que deseas eliminar la sucursal?</p>
  <p>Nombre:</p>
  <p>Dirección:</p>

  <button id="delete">Eliminar</button>
  <button onclick="location.href='../'">Cancelar</button>
</Layout>

<script define:vars={{ id }}>
  fetch(`http://localhost/api/branches/${id}`, {
    headers: {
      "Content-Type": "application/json",
    },
  })
    .then((response) => response.json())
    .then((data) => {
      document.querySelector("p:nth-of-type(2)").textContent += data.name;
      document.querySelector("p:nth-of-type(3)").textContent += data.address;
    });

  document.getElementById("delete").addEventListener("click", () => {
    // Alerta de confirmación
    if (window.confirm("¿Estás seguro de que deseas eliminar la sucursal?")) {
      fetch(`http://localhost/api/branches/${id}`, {
        method: "DELETE",
        headers: {
          "Content-Type": "application/json",
        },
      }).then((response) => {
        if (response.ok) {
          alert("Sucursal eliminada correctamente");
          location.href = "../";
        } else {
          alert("Error al eliminar la sucursal");
        }
      });
    }
  });
</script>
